---
title: EKS
description: "Setup Onyx on AWS EKS"
icon: "aws"
---

Using AWS EKS is a great way to run Onyx on a managed Kubernetes control plane with autoscaling compute.
This guide walks you through creating an EKS cluster, adding nodes, connecting from your CLI, and installing Onyx via Helm.

<Steps>
    <Step title="Prerequisites">
        - Download and install the [AWS CLI](https://aws.amazon.com/cli/). This is required for creating and accessing the cluster.
        - Download and install [kubectl CLI](https://kubernetes.io/docs/tasks/tools/install-kubectl-macos/). This is needed for cluster access through the CLI.
    </Step>

    <Step title="Create the Cluster">
        Navigate to Elastic Kubernetes Service (EKS) and create a new cluster.

        For `Cluster service role`, create a new IAM role accepting all the defaults for the user. Give it a descriptive name like `onyx-eks-cluster-role`.
        <Note>
            If you do not see the newly created role in the dropdown, click the refresh button in the UI.
        </Note>

        For the `Kubernetes version`, select a version with standard support and under `Upgrade policy`, choose `Standard`.
        In the add-ons section, add the `Amazon EBS CSI Driver` add-on, as this is needed for the Persistent Volume Claims (PVCs) to be fulfilled. Keep the other default add-ons enabled.

        <img className="rounded-image" src="/assets/setup_guides/aws/eks/cluster_create.png" alt="EKS Cluster Creation" />

        Select defaults for the rest of the forms. Review and click `Create` when satisfied. The cluster may take several minutes to become ready.
    </Step>

    <Step title="Add Nodes">
        Once the cluster is Active, add worker nodes where Onyx services will run.

        From the cluster page, select the `Compute` tab and click `Add node group`.

        <img className="rounded-image" src="/assets/setup_guides/aws/eks/add_node_group.png" alt="Add Node Group" />

        Provide a `Name` for the group (for example, `onyx-node-group`). For `Node IAM role`, either select an existing role used by your organization or create a new one. Ensure the role has the `AmazonEBSCSIDriverPolicy` attached so that PVCs can be fulfilled. If creating a role, AWS defaults work with the addition of this policy. A good role name would be `onyx-eks-nodegroup-role`.

        <img className="rounded-image" src="/assets/setup_guides/aws/eks/configure_group_node.png" alt="Configure Node Group" />

        Replace the `Instance types` with `c5.2xlarge` machines (or `c5.4xlarge` if you plan to scale beyond 100k documents).
        For disk, set `Volume size` in the 200GBâ€“800GB range depending on your document count (storage is inexpensive).
        For most setups, set the `Desired size` and `Minimum size` to 1. You can increase these later to scale up. `Maximum unavailable` can remain at the default.

        After reviewing, keep the default networking configuration and proceed to `Create`.

        <img className="rounded-image" src="/assets/setup_guides/aws/eks/set_compute_and_scaling.png" alt="Set Compute and Scaling" />

        It may take up to 15 minutes for the compute nodes to come online.
    </Step>

    <Step title="Create and Connect a User">
        You will need an IAM user with CLI access to manage AWS and the cluster.

        Go to the `IAM Dashboard` at [console.aws.amazon.com/iam](https://console.aws.amazon.com/iam/). Select `Users` in the left sidebar and then `Create user`.

        <img className="rounded-image" src="/assets/setup_guides/aws/eks/iam_dashboard.png" alt="IAM Dashboard Create User" />

        Name the user (for example, `onyx-eks-user`). Under permissions, click `Attach policies directly` and attach the following:
        - `AmazonEKSClusterPolicy`
        - `AmazonEKSServicePolicy`

        Finish creating the user.

        On the user's page, click `Create access key` and follow the prompts. Select the `Command Line Interface (CLI)` option during creation. Save the `Access key` and `Secret access key` for later.

        <img className="rounded-image" src="/assets/setup_guides/aws/eks/create_access_key.png" alt="Create Access Key" />

        Navigate back to the EKS cluster and select `Access` and then `Create access entry`.

        <img className="rounded-image" src="/assets/setup_guides/aws/eks/eks_access_entry.png" alt="EKS Access Entry" />

        In `IAM principal`, select the IAM ARN you just created, then click `Next`.

        <img className="rounded-image" src="/assets/setup_guides/aws/eks/eks_iam_arn.png" alt="Select IAM Principal ARN" />

        For Access policies, set `Policy name` to `AmazonEKSClusterAdminPolicy`, then click `Next`. Review and create the access policy.

        <img className="rounded-image" src="/assets/setup_guides/aws/eks/eks_policy.png" alt="EKS Access Policy" />
    </Step>

    <Step title="Fetch kubeconfig">
        Log in to the AWS CLI and provide the access key and secret key from the IAM user you created:

        ```bash
        aws configure
        ```

        Configure your kubeconfig to connect to the cluster by filling in the `region-code` and `cluster-name`:

        ```bash
        aws eks update-kubeconfig --region region-code --name cluster-name
        ```

        Additional material: [AWS EKS kubeconfig docs](https://docs.aws.amazon.com/eks/latest/userguide/create-kubeconfig.html).
    </Step>

    <Step title="Install Onyx Services">
        Create a dedicated namespace for Onyx.

        ```bash
        kubectl create ns onyx
        ```

        Ensure the `gp2` storage class is set as the default storage class (required for PVCs):

        ```bash
        kubectl patch storageclass gp2 -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}' -n onyx
        ```

        Navigate to the `onyx/deployment/helm/charts/onyx` directory in the repository you cloned. Make sure you have [Helm installed](https://helm.sh/docs/intro/install/).

        Review the `values.yaml` and adjust as necessary. Then install the Onyx Helm chart:

        ```bash
        helm install onyx . --create-namespace --namespace onyx
        ```

        It may take a few minutes for all services to come online. To monitor progress:

        ```bash
        kubectl -n onyx get pods
        ```

        To check the API server logs (often the last to become ready):

        ```bash
        kubectl -n onyx get pods | grep api-server | awk '{print $1}' | xargs -I {} kubectl -n onyx logs {} -f
        ```

        To find the Nginx load balancer address and open it in your browser:

        ```bash
        kubectl get svc -n onyx | grep nginx | awk '{print $4}'
        ```
    </Step>

    <Step title="Upgrading">
        To upgrade Onyx services, update the `global.version` field in `values.yaml` to the desired version (for example, `nightly-latest-20250616`). Then run:

        ```bash
        helm upgrade onyx . -n onyx
        ```
    </Step>

    <Step title="Uninstalling">
        To remove the Onyx services:

        ```bash
        helm uninstall onyx -n onyx
        ```

        Vespa, Postgres, and MinIO leave behind PVCs. Delete them if you are completely done:

        ```bash
        kubectl -n onyx get pvc
        kubectl -n onyx delete pvc vespa-storage-da-vespa-0
        kubectl -n onyx delete pvc onyx-minio
        kubectl -n onyx delete pvc data-onyx-postgresql-0
        ```
    </Step>
</Steps>

## Next Steps

<CardGroup cols={2}>
  <Card title="Configure Authentication" icon="shield-check" href="/deployment/authentication/basic">
    Set up authentication for your Onyx deployment with OAuth, OIDC, or SAML.
  </Card>
  <Card title="Environment Variables" icon="gear" href="/deployment/configuration/env_vars">
    Learn about all available configuration options for your Onyx deployment.
  </Card>
</CardGroup>