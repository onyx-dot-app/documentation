---
title: "Simple Example"
---

# Simple Example: Create Jira Ticket Action and Agent

This example demonstrates how to create a custom action that integrates with Jira to create tickets, then create an agent that can use this action, and finally send a chat message that utilizes the action.

## Overview

We'll create:
1. **Custom Action**: A Jira ticket creation tool
2. **Support Agent**: An agent equipped with the Jira action
3. **Chat Integration**: Send a message that triggers ticket creation

## Python Example

```python
import requests
import json

# Configuration
API_BASE_URL = "https://cloud.onyx.app/api"
API_KEY = "your_api_key_here"

headers = {
    "Authorization": f"Bearer {API_KEY}",
    "Content-Type": "application/json"
}

# Step 1: Create the Jira Ticket Action
action_data = {
    "name": "Create Jira Ticket",
    "description": "Creates a new Jira ticket with specified details",
    "definition": {
        "type": "function",
        "function": {
            "name": "create_jira_ticket",
            "description": "Create a new Jira ticket",
            "parameters": {
                "type": "object",
                "properties": {
                    "summary": {
                        "type": "string",
                        "description": "Brief summary of the issue"
                    },
                    "description": {
                        "type": "string", 
                        "description": "Detailed description of the issue"
                    },
                    "priority": {
                        "type": "string",
                        "enum": ["Low", "Medium", "High", "Critical"],
                        "description": "Priority level of the ticket"
                    },
                    "issue_type": {
                        "type": "string",
                        "enum": ["Bug", "Task", "Story", "Epic"],
                        "description": "Type of Jira issue"
                    }
                },
                "required": ["summary", "description"]
            }
        }
    }
}

# Create the action
response = requests.post(
    f"{API_BASE_URL}/admin/tool/custom",
    headers=headers,
    json=action_data
)

if response.status_code == 200:
    action = response.json()
    action_id = action["id"]
    print(f"‚úÖ Jira action created successfully!")
    print(f"Action ID: {action_id}")
    print(f"Action Name: {action['name']}")
else:
    print(f"‚ùå Failed to create action: {response.status_code}")
    print(response.text)
    exit(1)

# Step 2: Create a Support Agent with the Jira action
agent_data = {
    "name": "Support Agent",
    "description": "AI agent for customer support that can create and manage Jira tickets",
    "system_prompt": """You are a Support Agent, an expert AI agent for customer support teams.

Your expertise includes:
- Customer service best practices
- Issue troubleshooting and resolution
- Ticket management and escalation
- Technical problem diagnosis

Your role is to:
- Help customers resolve their issues
- Create Jira tickets for bugs and feature requests
- Escalate complex problems appropriately
- Maintain professional, helpful communication

Guidelines:
- Always gather sufficient information before creating tickets
- Use appropriate priority levels based on issue severity
- Provide clear, actionable responses to customers
- Create tickets when issues require developer attention

When creating Jira tickets:
- Use clear, descriptive summaries
- Include all relevant details in the description
- Set appropriate priority (Critical for outages, High for major bugs, Medium for minor issues, Low for enhancements)
- Choose correct issue type (Bug for defects, Task for work items, Story for features)""",
    
    "num_chunks": 10,
    "document_set_ids": [1, 2],  # Support docs, FAQ
    "tool_ids": [action_id],  # Include our Jira action
    "starter_messages": [
        "Hi! I'm here to help resolve your issue. What problem are you experiencing?",
        "I can help troubleshoot your issue and create tickets if needed. What's going on?",
        "What technical issue can I assist you with today?"
    ],
    "is_public": False
}

# Create the agent
response = requests.post(
    f"{API_BASE_URL}/admin/persona",
    headers=headers,
    json=agent_data
)

if response.status_code == 200:
    agent = response.json()
    agent_id = agent["id"]
    print(f"‚úÖ Support Agent created successfully!")
    print(f"Agent ID: {agent_id}")
else:
    print(f"‚ùå Failed to create agent: {response.status_code}")
    print(response.text)
    exit(1)

# Step 3: Create a chat session with the agent
chat_data = {
    "persona_id": agent_id,
    "description": "Customer support session"
}

response = requests.post(
    f"{API_BASE_URL}/chat/create-chat-session",
    headers=headers,
    json=chat_data
)

if response.status_code == 200:
    session = response.json()
    session_id = session["chat_session_id"]
    print(f"‚úÖ Chat session created: {session_id}")
else:
    print(f"‚ùå Failed to create chat session: {response.status_code}")
    print(response.text)
    exit(1)

# Step 4: Send a message that will trigger the Jira action
message_data = {
    "message": "I found a critical bug in the login system. When users try to log in with their email, they get a 500 error and can't access their accounts. This is affecting multiple customers and needs immediate attention.",
    "chat_session_id": session_id,
    "retrieval_options": {
        "run_search": "always"
    }
}

response = requests.post(
    f"{API_BASE_URL}/chat/send-message",
    headers=headers,
    json=message_data
)

if response.status_code == 200:
    message_response = response.json()
    print(f"\nü§ñ Support Agent Response:")
    print(f"Message: {message_response['message']}")
    
    # Check if the agent used the Jira action
    if message_response.get('tool_calls'):
        print(f"\nüîß Actions Used:")
        for tool_call in message_response['tool_calls']:
            print(f"- {tool_call['function']['name']}")
            print(f"  Arguments: {tool_call['function']['arguments']}")
else:
    print(f"‚ùå Failed to send message: {response.status_code}")
    print(response.text)
```

## JavaScript/Node.js Example

```javascript
const API_BASE_URL = "https://cloud.onyx.app/api";
const API_KEY = "your_api_key_here";

const headers = {
    "Authorization": `Bearer ${API_KEY}`,
    "Content-Type": "application/json"
};

async function createJiraActionAndAgent() {
    try {
        // Step 1: Create the Jira Ticket Action
        const actionData = {
            name: "Create Jira Ticket",
            description: "Creates a new Jira ticket with specified details",
            definition: {
                type: "function",
                function: {
                    name: "create_jira_ticket",
                    description: "Create a new Jira ticket",
                    parameters: {
                        type: "object",
                        properties: {
                            summary: {
                                type: "string",
                                description: "Brief summary of the issue"
                            },
                            description: {
                                type: "string",
                                description: "Detailed description of the issue"
                            },
                            priority: {
                                type: "string",
                                enum: ["Low", "Medium", "High", "Critical"],
                                description: "Priority level of the ticket"
                            },
                            issue_type: {
                                type: "string",
                                enum: ["Bug", "Task", "Story", "Epic"],
                                description: "Type of Jira issue"
                            }
                        },
                        required: ["summary", "description"]
                    }
                }
            }
        };

        const actionResponse = await fetch(`${API_BASE_URL}/admin/tool/custom`, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(actionData)
        });

        if (!actionResponse.ok) {
            throw new Error(`Failed to create action: ${actionResponse.status}`);
        }

        const action = await actionResponse.json();
        console.log(`‚úÖ Jira action created successfully!`);
        console.log(`Action ID: ${action.id}`);
        console.log(`Action Name: ${action.name}`);

        // Step 2: Create a Support Agent with the Jira action
        const agentData = {
            name: "Support Agent",
            description: "AI agent for customer support that can create and manage Jira tickets",
            system_prompt: `You are a Support Agent, an expert AI agent for customer support teams.

Your expertise includes:
- Customer service best practices
- Issue troubleshooting and resolution
- Ticket management and escalation
- Technical problem diagnosis

Your role is to:
- Help customers resolve their issues
- Create Jira tickets for bugs and feature requests
- Escalate complex problems appropriately
- Maintain professional, helpful communication

Guidelines:
- Always gather sufficient information before creating tickets
- Use appropriate priority levels based on issue severity
- Provide clear, actionable responses to customers
- Create tickets when issues require developer attention

When creating Jira tickets:
- Use clear, descriptive summaries
- Include all relevant details in the description
- Set appropriate priority (Critical for outages, High for major bugs, Medium for minor issues, Low for enhancements)
- Choose correct issue type (Bug for defects, Task for work items, Story for features)`,
            
            num_chunks: 10,
            document_set_ids: [1, 2], // Support docs, FAQ
            tool_ids: [action.id], // Include our Jira action
            starter_messages: [
                "Hi! I'm here to help resolve your issue. What problem are you experiencing?",
                "I can help troubleshoot your issue and create tickets if needed. What's going on?",
                "What technical issue can I assist you with today?"
            ],
            is_public: false
        };

        const agentResponse = await fetch(`${API_BASE_URL}/admin/persona`, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(agentData)
        });

        if (!agentResponse.ok) {
            throw new Error(`Failed to create agent: ${agentResponse.status}`);
        }

        const agent = await agentResponse.json();
        console.log(`‚úÖ Support Agent created successfully!`);
        console.log(`Agent ID: ${agent.id}`);

        // Step 3: Create a chat session with the agent
        const chatData = {
            persona_id: agent.id,
            description: "Customer support session"
        };

        const chatResponse = await fetch(`${API_BASE_URL}/chat/create-chat-session`, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(chatData)
        });

        if (!chatResponse.ok) {
            throw new Error(`Failed to create chat session: ${chatResponse.status}`);
        }

        const session = await chatResponse.json();
        console.log(`‚úÖ Chat session created: ${session.chat_session_id}`);

        // Step 4: Send a message that will trigger the Jira action
        const messageData = {
            message: "I found a critical bug in the login system. When users try to log in with their email, they get a 500 error and cannot access their accounts. This is affecting multiple customers and needs immediate attention.",
            chat_session_id: session.chat_session_id,
            retrieval_options: {
                run_search: "always"
            }
        };

        const messageResponse = await fetch(`${API_BASE_URL}/chat/send-message`, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(messageData)
        });

        if (!messageResponse.ok) {
            throw new Error(`Failed to send message: ${messageResponse.status}`);
        }

        const messageResult = await messageResponse.json();
        console.log(`\nü§ñ Support Agent Response:`);
        console.log(`Message: ${messageResult.message}`);
        
        if (messageResult.tool_calls) {
            console.log(`\nüîß Actions Used:`);
            messageResult.tool_calls.forEach(toolCall => {
                console.log(`- ${toolCall.function.name}`);
                console.log(`  Arguments: ${JSON.stringify(toolCall.function.arguments, null, 2)}`);
            });
        }

    } catch (error) {
        console.error(`‚ùå Error: ${error.message}`);
    }
}

// Run the example
createJiraActionAndAgent();
```

## cURL Example

```bash
# Step 1: Create the Jira Ticket Action
curl -X POST "https://cloud.onyx.app/api/admin/tool/custom" \
  -H "Authorization: Bearer your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Create Jira Ticket",
    "description": "Creates a new Jira ticket with specified details",
    "definition": {
      "type": "function",
      "function": {
        "name": "create_jira_ticket",
        "description": "Create a new Jira ticket",
        "parameters": {
          "type": "object",
          "properties": {
            "summary": {
              "type": "string",
              "description": "Brief summary of the issue"
            },
            "description": {
              "type": "string",
              "description": "Detailed description of the issue"
            },
            "priority": {
              "type": "string",
              "enum": ["Low", "Medium", "High", "Critical"],
              "description": "Priority level of the ticket"
            },
            "issue_type": {
              "type": "string",
              "enum": ["Bug", "Task", "Story", "Epic"],
              "description": "Type of Jira issue"
            }
          },
          "required": ["summary", "description"]
        }
      }
    }
  }'

# Response: Save the action_id from the response

# Step 2: Create a Support Agent with the Jira action
curl -X POST "https://cloud.onyx.app/api/admin/persona" \
  -H "Authorization: Bearer your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Support Agent",
    "description": "AI agent for customer support that can create Jira tickets",
    "system_prompt": "You are a Support Agent, an expert AI agent for customer support teams...",
    "num_chunks": 10,
    "document_set_ids": [1, 2],
    "tool_ids": [YOUR_ACTION_ID],
    "starter_messages": [
      "Hi! I am here to help resolve your issue. What problem are you experiencing?"
    ],
    "is_public": false
  }'

# Response: Save the agent_id from the response

# Step 3: Create a chat session
curl -X POST "https://cloud.onyx.app/api/chat/create-chat-session" \
  -H "Authorization: Bearer your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "persona_id": YOUR_AGENT_ID,
    "description": "Customer support session"
  }'

# Response: Save the chat_session_id from the response

# Step 4: Send a message that will trigger the Jira action
curl -X POST "https://cloud.onyx.app/api/chat/send-message" \
  -H "Authorization: Bearer your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "I found a critical bug in the login system. When users try to log in with their email, they get a 500 error and cannot access their accounts. This is affecting multiple customers and needs immediate attention.",
    "chat_session_id": YOUR_CHAT_SESSION_ID,
    "retrieval_options": {
      "run_search": "always"
    }
  }'
```

## Key Features Demonstrated

### Custom Action Creation
- **Function Definition**: Define the action's parameters and behavior
- **Type Safety**: Use JSON schema for parameter validation
- **Integration Ready**: Actions can integrate with external services

### Agent Configuration
- **Tool Integration**: Equip agents with custom actions
- **Specialized Behavior**: System prompts tailored for support scenarios
- **Knowledge Access**: Connect to relevant documentation

### Intelligent Tool Usage
- **Context Awareness**: Agent determines when to use actions
- **Parameter Extraction**: Automatically extracts action parameters from conversations
- **Response Integration**: Incorporates action results into responses

## Expected Workflow

1. **User Reports Issue**: Customer describes a problem or bug
2. **Agent Assessment**: Support agent analyzes the issue severity
3. **Action Trigger**: Agent determines if a Jira ticket should be created
4. **Ticket Creation**: Agent calls the Jira action with appropriate parameters
5. **User Response**: Agent confirms ticket creation and provides ticket details

## Advanced Configuration

### Priority Logic
The agent can intelligently set priorities based on keywords and context:
- **Critical**: "outage", "can't access", "affecting all users"
- **High**: "major bug", "blocking", "urgent"
- **Medium**: "minor bug", "issue", "problem"
- **Low**: "enhancement", "improvement", "suggestion"

### Issue Type Detection
The agent can categorize issues appropriately:
- **Bug**: "error", "broken", "not working", "bug"
- **Task**: "update", "change", "modify"
- **Story**: "feature", "add", "new functionality"
- **Epic**: "major initiative", "big project"

### Integration Options
- **Jira Cloud**: Use Jira REST API with authentication
- **Jira Server**: Connect to on-premise Jira instances
- **Custom Fields**: Include project-specific fields
- **Webhook Responses**: Handle Jira webhook responses

## Best Practices

### Action Design
- **Clear Parameters**: Define clear, required parameters
- **Error Handling**: Include proper error responses
- **Documentation**: Provide clear descriptions for all parameters

### Agent Configuration  
- **Specific Prompts**: Create detailed system prompts for action usage
- **Knowledge Integration**: Connect relevant documentation
- **Testing**: Test action integration thoroughly

### User Experience
- **Confirmation**: Always confirm action execution with users
- **Transparency**: Explain what actions are being taken
- **Follow-up**: Provide ticket numbers and next steps

## Troubleshooting

### Common Issues
- **Action Not Triggered**: Check system prompt and action description
- **Missing Parameters**: Ensure required parameters are clearly defined
- **Authentication Errors**: Verify API credentials and permissions

### Debugging Tips
- **Test Actions Separately**: Verify actions work independently
- **Check Logs**: Review chat logs for action calls
- **Validate Parameters**: Ensure parameter extraction is working

For more information on actions and agents, see the [Actions API documentation](/api_reference/actions/list_actions) and [Agents API documentation](/api_reference/agents/list_agents). 