---
title: "Simple Example"
---

# Simple Example: Add an Agent to a Group

This example demonstrates how to create a user group and add an agent to it, enabling the group members to access the agent.

## Overview

We'll:
1. **Create an Agent**: Set up a Sales Copilot agent
2. **Create a User Group**: Set up a sales team group
3. **Add Agent to Group**: Grant the group access to the agent

## Python Example

```python
import requests
import json

# Configuration
API_BASE_URL = "https://cloud.onyx.app/api"
API_KEY = "your_api_key_here"

headers = {
    "Authorization": f"Bearer {API_KEY}",
    "Content-Type": "application/json"
}

# Step 1: Create a Sales Copilot Agent
agent_data = {
    "name": "Sales Copilot",
    "description": "AI agent for sales team with access to CRM and sales materials",
    "system_prompt": "You are a Sales Copilot agent helping the sales team with customer inquiries, lead qualification, and sales processes.",
    "num_chunks": 10,
    "document_set_ids": [1, 2],  # Sales docs, CRM data
    "tool_ids": [],
    "is_public": False,
    "users": [],
    "groups": []
}

# Create the agent
response = requests.post(
    f"{API_BASE_URL}/persona",
    headers=headers,
    json=agent_data
)

if response.status_code == 200:
    agent = response.json()
    agent_id = agent["id"]
    print(f"✅ Agent created successfully!")
    print(f"Agent ID: {agent_id}")
    print(f"Agent Name: {agent['name']}")
else:
    print(f"❌ Failed to create agent: {response.status_code}")
    print(response.text)
    exit(1)

# Step 2: Create a Sales Team Group
group_data = {
    "name": "Sales Team",
    "user_ids": [101, 102, 103],  # Sales team member IDs
    "cc_pair_ids": [1, 2],        # Connected CRM and sales docs
    "personas": [agent_id],  # Add agent to group
    "is_up_to_date": True,
    "is_up_for_deletion": False
}

# Create the group
response = requests.post(
    f"{API_BASE_URL}/manage/admin/user-group",
    headers=headers,
    json=group_data
)

if response.status_code == 200:
    group = response.json()
    group_id = group["id"]
    print(f"✅ Group created successfully!")
    print(f"Group ID: {group_id}")
    print(f"Group Name: {group['name']}")
else:
    print(f"❌ Failed to create group: {response.status_code}")
    print(response.text)
    exit(1)

# Step 3: Verify the agent is accessible to the group
response = requests.get(
    f"{API_BASE_URL}/manage/admin/user-group/{group_id}",
    headers=headers
)

if response.status_code == 200:
    updated_group = response.json()
    print(f"\n✅ Group configuration verified!")
    print(f"Group has {len(updated_group.get('personas', []))} agent(s)")
    print(f"Group has {len(updated_group.get('users', []))} user(s)")
    print(f"Group has {len(updated_group.get('cc_pairs', []))} connector(s)")
else:
    print(f"❌ Failed to verify group: {response.status_code}")
    print(response.text)
```

## JavaScript/Node.js Example

```javascript
const API_BASE_URL = "https://cloud.onyx.app/api";
const API_KEY = "your_api_key_here";

const headers = {
    "Authorization": `Bearer ${API_KEY}`,
    "Content-Type": "application/json"
};

async function addAgentToGroup() {
    try {
        // Step 1: Create a Sales Copilot Agent
        const agentData = {
            name: "Sales Copilot",
            description: "AI agent for sales team with access to CRM and sales materials",
            system_prompt: "You are a Sales Copilot agent helping the sales team with customer inquiries, lead qualification, and sales processes.",
            num_chunks: 10,
            document_set_ids: [1, 2], // Sales docs, CRM data
            tool_ids: [],
            is_public: false,
            users: [],
            groups: []
        };

        const agentResponse = await fetch(`${API_BASE_URL}/persona`, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(agentData)
        });

        if (!agentResponse.ok) {
            throw new Error(`Failed to create agent: ${agentResponse.status}`);
        }

        const agent = await agentResponse.json();
        console.log(`✅ Agent created successfully!`);
        console.log(`Agent ID: ${agent.id}`);
        console.log(`Agent Name: ${agent.name}`);

        // Step 2: Create a Sales Team Group with the agent
        const groupData = {
            name: "Sales Team",
            user_ids: [101, 102, 103], // Sales team member IDs
            cc_pair_ids: [1, 2],       // Connected CRM and sales docs
            personas: [agent.id],
            is_up_to_date: true,
            is_up_for_deletion: false
        };

        const groupResponse = await fetch(`${API_BASE_URL}/manage/admin/user-group`, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(groupData)
        });

        if (!groupResponse.ok) {
            throw new Error(`Failed to create group: ${groupResponse.status}`);
        }

        const group = await groupResponse.json();
        console.log(`✅ Group created successfully!`);
        console.log(`Group ID: ${group.id}`);
        console.log(`Group Name: ${group.name}`);

        // Step 3: Verify the group configuration
        const verifyResponse = await fetch(`${API_BASE_URL}/manage/admin/user-group/${group.id}`, {
            method: 'GET',
            headers: headers
        });

        if (!verifyResponse.ok) {
            throw new Error(`Failed to verify group: ${verifyResponse.status}`);
        }

        const updatedGroup = await verifyResponse.json();
        console.log(`\n✅ Group configuration verified!`);
        console.log(`Group has ${updatedGroup.personas?.length || 0} agent(s)`);
        console.log(`Group has ${updatedGroup.users?.length || 0} user(s)`);
        console.log(`Group has ${updatedGroup.cc_pairs?.length || 0} connector(s)`);

    } catch (error) {
        console.error(`❌ Error: ${error.message}`);
    }
}

// Run the example
addAgentToGroup();
```

## cURL Example

```bash
# Step 1: Create a Sales Copilot Agent
curl -X POST "https://cloud.onyx.app/api/persona" \
  -H "Authorization: Bearer your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Sales Copilot",
    "description": "AI agent for sales team with access to CRM and sales materials",
    "system_prompt": "You are a Sales Copilot agent helping the sales team.",
    "num_chunks": 10,
    "document_set_ids": [1, 2],
    "tool_ids": [],
    "is_public": false
  }'

# Response: Save the agent_id from the response

# Step 2: Create a Sales Team Group with the agent
curl -X POST "https://cloud.onyx.app/api/manage/admin/user-group" \
  -H "Authorization: Bearer your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Sales Team",
    "user_ids": [101, 102, 103],
    "cc_pair_ids": [1, 2],
    "personas": ["AGENT_ID"],
    "is_up_to_date": true,
    "is_up_for_deletion": false
  }'

# Response: Save the group_id from the response

# Step 3: Verify the group configuration
curl -X GET "https://cloud.onyx.app/api/manage/admin/user-group/GROUP_ID" \
  -H "Authorization: Bearer your_api_key_here"
```

## Key Concepts

### User Groups
User groups in Onyx provide access control and resource sharing:
- **Users**: Members who can access group resources
- **Agents**: AI agents available to group members
- **Connectors**: Data sources accessible to the group
- **Permissions**: Controlled access to organizational resources

### Agent Access Control
When you add an agent to a group:
- **Group Members**: Can access and chat with the agent
- **Knowledge Base**: Agent uses group's connected data sources
- **Permissions**: Inherits group's access permissions
- **Isolation**: Agent responses are scoped to group's data

### Resource Sharing
Groups enable efficient resource sharing:
- **Centralized Management**: Manage agent access from one place
- **Team Collaboration**: Share specialized agents across teams
- **Data Security**: Control who can access which agents and data
- **Cost Efficiency**: Share agent costs across team members

## Common Use Cases

### Sales Team Setup
```json
{
  "name": "Sales Team",
  "user_ids": [101, 102, 103],
  "cc_pair_ids": [1, 2],        // CRM, Sales playbooks
  "personas": [5, 6],           // Sales Agent, Lead Qualifier
  "is_up_to_date": true
}
```

### Engineering Team Setup
```json
{
  "name": "Engineering Team", 
  "user_ids": [201, 202, 203],
  "cc_pair_ids": [3, 4],        // Code repos, Technical docs
  "personas": [7, 8],           // Code Review Agent, DevOps Agent
  "is_up_to_date": true
}
```

### Support Team Setup
```json
{
  "name": "Support Team",
  "user_ids": [301, 302, 303],
  "cc_pair_ids": [5, 6],        // Help docs, FAQs
  "personas": [9, 10],          // Support Agent, Escalation Agent
  "is_up_to_date": true
}
```

## Best Practices

### Group Organization
- **Role-Based Groups**: Organize groups by job function or department
- **Resource Alignment**: Match agents and connectors to group needs
- **Regular Updates**: Keep group membership current
- **Access Reviews**: Periodically review group permissions

### Agent Assignment
- **Relevant Agents**: Only add agents that serve the group's needs
- **Specialized Access**: Create role-specific agents for different groups
- **Knowledge Alignment**: Ensure agents have access to relevant data sources
- **Performance Monitoring**: Track agent usage within groups

### Security Considerations
- **Principle of Least Privilege**: Grant minimum necessary access
- **Data Classification**: Ensure sensitive data access is properly controlled
- **Regular Audits**: Review group membership and permissions
- **Access Logging**: Monitor agent and data access patterns

## Advanced Configuration

### Dynamic Group Management
```python
# Add users dynamically
def add_user_to_group(group_id, user_id):
    group = get_group(group_id)
    group["user_ids"].append(user_id)
    return update_group(group_id, group)

# Add agents dynamically  
def add_agent_to_group(group_id, agent_id):
    group = get_group(group_id)
    group["personas"].append(agent_id)
    return update_group(group_id, group)
```

### Multi-Group Agent Access
Agents can be assigned to multiple groups for broader access:

```json
{
  "agent_id": 5,
  "assigned_groups": [
    {"group_id": 1, "name": "Sales Team"},
    {"group_id": 2, "name": "Marketing Team"},
    {"group_id": 3, "name": "Customer Success"}
  ]
}
```

### Hierarchical Groups
Create parent-child group relationships:

```json
{
  "parent_group": {
    "name": "Revenue Team",
    "child_groups": [
      {"name": "Sales Team", "id": 1},
      {"name": "Marketing Team", "id": 2}
    ]
  }
}
```

## Troubleshooting

### Common Issues
- **Agent Not Visible**: Check if agent is properly added to group
- **Permission Denied**: Verify user is member of the group
- **Data Access Issues**: Ensure connectors are included in group

### Debugging Steps
1. **Verify Group Membership**: Check user is in the correct group
2. **Check Agent Assignment**: Confirm agent is added to group's personas
3. **Review Connector Access**: Ensure necessary data sources are connected
4. **Test Agent Functionality**: Verify agent works independently

For more information on group management, see the [Group Management API documentation](/api_reference/group_management/list_groups). 